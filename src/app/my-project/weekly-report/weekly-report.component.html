<div [@routerTransition]>
  <section class="content pb-4">
    <form [formGroup]="reportForm">
      <div class="row mb-4">
        <div class="col-12 fw-bolder bg-gray">Key Project Updates</div>
        <textarea class="w-100" formControlName="keyProjectUpdates"></textarea>
        <app-form-field-error class="p-0" [_control]="reportForm.get('keyProjectUpdates')" [submitted]="isSubmitted">
        </app-form-field-error>
      </div>
      <div class="row mb-4">
        <div class="col-12 fw-bolder bg-gray">
          Dependencies
          <button type="button" class="btn btn-link float-end" (click)="addFormControl('dependencies')">+ Add Dependency</button>
        </div>
        <div class="row">
          <div class="col-6 fw-bolder border">Description</div>
          <div class="col-3 fw-bolder border-top border-end border-bottom">Owner</div>
          <div class="col-2 fw-bolder border-top border-end border-bottom">ETD</div>
        </div>
        <div class="row" formArrayName="dependencies">
          <ng-container class="row" *ngFor="let dep of getControls('dependencies')['controls']; let i = index"
            [formGroupName]="i">
            <div class="col-6 p-2 border">
              <input type="text" pInputText class="w-100" formControlName="description"/>
              <app-form-field-error [_control]="showErr('dependencies', i, 'description')" [submitted]="isSubmitted">
              </app-form-field-error>
            </div>
            <div class="col-3 p-2 border-top border-end border-bottom">
              <input type="text" pInputText class="w-100" formControlName="owner"/>
              <app-form-field-error [_control]="showErr('dependencies', i, 'owner')" [submitted]="isSubmitted">
              </app-form-field-error>
            </div>
            <div class="col-2 p-2 border-top border-end border-bottom">
              <p-calendar [maxDate]="maxDate" class="w-100" formControlName="etd"></p-calendar>
              <app-form-field-error [_control]="showErr('dependencies', i, 'etd')" [submitted]="isSubmitted">
              </app-form-field-error>
            </div>

            <div class="col-1 position-relative">
              <i class="fa-solid fa-xmark" (click)="removeOrClearEmail('dependencies', i)"></i>
            </div>
          </ng-container>
        </div>
      </div>
      <div class="row mb-4">
        <div class="col-12 fw-bolder bg-gray">
          Top Risk/Issue
          <button type="button" class="btn btn-link float-end" (click)="addFormControl('topRiskIssue')">+ Add Risk/Issue</button>
        </div>
        <div class="row">
          <div class="col-2 fw-bolder border">Rik/Issue</div>
          <div class="col-3 fw-bolder border-top border-end border-bottom">Description</div>
          <div class="col-2 fw-bolder border-top border-end border-bottom">Owner</div>
          <div class="col-2 fw-bolder border-top border-end border-bottom">Priority</div>
          <div class="col-2 fw-bolder border-top border-end border-bottom">ETD</div>
        </div>
        <div class="row" formArrayName="topRiskIssue">
          <ng-container class="row" *ngFor="let dep of getControls('topRiskIssue')['controls']; let i = index"
            [formGroupName]="i">
            <div class="col-2 p-2 border">
              <input type="text" pInputText class="w-100" formControlName="riskIssue"/>
              <app-form-field-error [_control]="showErr('topRiskIssue', i, 'riskIssue')" [submitted]="isSubmitted">
              </app-form-field-error>
            </div>
            <div class="col-3 p-2 border-top border-end border-bottom">
              <input type="text" pInputText class="w-100" formControlName="description"/>
              <app-form-field-error [_control]="showErr('topRiskIssue', i, 'description')" [submitted]="isSubmitted">
              </app-form-field-error>
            </div>
            <div class="col-2 p-2 border">
              <input type="text" pInputText class="w-100" formControlName="owner"/>
              <app-form-field-error [_control]="showErr('topRiskIssue', i, 'owner')" [submitted]="isSubmitted">
              </app-form-field-error>
            </div>
            <div class="col-2 p-2 border-top border-end border-bottom">
              <input type="text" pInputText class="w-100" formControlName="priority"/>
              <app-form-field-error [_control]="showErr('topRiskIssue', i, 'priority')" [submitted]="isSubmitted">
              </app-form-field-error>
            </div>
            <div class="col-2 p-2 border-top border-end border-bottom">
              <p-calendar [maxDate]="maxDate" class="w-100" formControlName="etd"></p-calendar>
              <app-form-field-error [_control]="showErr('topRiskIssue', i, 'etd')" [submitted]="isSubmitted">
              </app-form-field-error>
            </div>

            <div class="col-1 position-relative">
              <i class="fa-solid fa-xmark" (click)="removeOrClearEmail('topRiskIssue', i)"></i>
            </div>
          </ng-container>
        </div>
      </div>
      <div class="row mb-4">
        <div class="col-12 fw-bolder bg-gray">
          Next Steps
          <button type="button" class="btn btn-link float-end" (click)="addFormControl('nextSteps')">+ Add Dependency</button>
        </div>
        <div class="row">
          <div class="col-6 fw-bolder border">Description</div>
          <div class="col-3 fw-bolder border-top border-end border-bottom">Owner</div>
          <div class="col-2 fw-bolder border-top border-end border-bottom">ETD</div>
        </div>
        <div class="row" formArrayName="nextSteps">
          <ng-container class="row" *ngFor="let dep of getControls('nextSteps')['controls']; let i = index"
            [formGroupName]="i">
            <div class="col-6 p-2 border">
              <input type="text" pInputText class="w-100" formControlName="description"/>
              <app-form-field-error [_control]="showErr('nextSteps', i, 'description')" [submitted]="isSubmitted">
              </app-form-field-error>
            </div>
            <div class="col-3 p-2 border-top border-end border-bottom">
              <input type="text" pInputText class="w-100" formControlName="owner"/>
              <app-form-field-error [_control]="showErr('nextSteps', i, 'owner')" [submitted]="isSubmitted">
              </app-form-field-error>
            </div>
            <div class="col-2 p-2 border-top border-end border-bottom">
              <p-calendar [maxDate]="maxDate" class="w-100" formControlName="etd"></p-calendar>
              <app-form-field-error [_control]="showErr('nextSteps', i, 'etd')" [submitted]="isSubmitted">
              </app-form-field-error>
            </div>

            <div class="col-1 position-relative">
              <i class="fa-solid fa-xmark" (click)="removeOrClearEmail('nextSteps', i)"></i>
            </div>
          </ng-container>
        </div>
      </div>
      <div class="row mb-4">
        <div class="col-6 p-1 fw-bolder bg-gray">
          RAG Status<br> 
          <p-dropdown formControlName="status" [options]="ragStatus" optionLabel="label" optionValue="value"
            placeholder="Select RAG Status"></p-dropdown><br>
          <app-form-field-error class="fw-normal" [_control]="reportForm.get('status')" [submitted]="isSubmitted">
          </app-form-field-error>
        </div>
        <div class="col-6 p-1 fw-bolder bg-gray">
          RAG Schedule<br> 
          <p-dropdown formControlName="schedule" [options]="ragSchedule" optionLabel="label" optionValue="value"
            placeholder="Select RAG Schedule"></p-dropdown><br>
          <app-form-field-error class="fw-normal" [_control]="reportForm.get('schedule')" [submitted]="isSubmitted">
          </app-form-field-error>
        </div>
        <div class="col-6 p-1 fw-bolder bg-gray">
          RAG Scope<br> 
          <p-dropdown formControlName="scope" [options]="ragScope" optionLabel="label" optionValue="value"
            placeholder="Select RAG Scope"></p-dropdown><br>
          <app-form-field-error class="fw-normal" [_control]="reportForm.get('scope')" [submitted]="isSubmitted">
          </app-form-field-error>
        </div>
        <div class="col-6 p-1 fw-bolder bg-gray">
          RAG Effort/Cost<br> 
          <p-dropdown formControlName="effortCost" [options]="ragEffort" optionLabel="label" optionValue="value"
            placeholder="Select RAG Effort"></p-dropdown><br>
          <app-form-field-error class="fw-normal" [_control]="reportForm.get('effortCost')" [submitted]="isSubmitted">
          </app-form-field-error>
        </div>
      </div>
    </form>
    <div class="col-12 submitBtn">
      <button class="btn btn-success w-50" (click)="submitReport()">Submit</button>
    </div>
  </section>
</div>